# Cloudflare Workers integration

Frames.js can be easily deployed to [Cloudflare Workers](https://workers.cloudflare.com).

## Create a new project using `wrangler`

:::code-group

```bash [npm]
npm create cloudflare -- my-cf-frames --type hello-world --ts && cd ./my-cf-frames
```

```bash [yarn]
yarn create cloudflare my-cf-frames --type hello-world --ts && cd ./my-cf-frames
```

```bash [pnpm]
pnpm create cloudflare my-cf-frames --type hello-world --ts && cd ./my-cf-frames
```

:::

## Install `frames.js`

In order for `frames.js` to work properly in [Cloudflare Workers](https://workers.cloudflare.com) you must replace the `@vercel/og` dependency with `workers-og`. Follow following steps to override the dependency.

::::steps

### Override `@vercel/og` package with `workers-og`

Add following to your `package.json`.

:::code-group

```json [npm]
{
  "overrides": {
    "frames.js": {
      "@vercel/og": "npm:workers-og@^0.0.23"
    }
  }
}
```

```json [yarn]
{
  "resolutions": {
    "@vercel/og": "npm:workers-og"
  }
}
```

```json [pnpm]
{
  "pnpm": {
    "overrides": {
      "@vercel/og": "npm:workers-og@^0.0.23"
    }
  }
}
```

:::

### Install the dependencies

After you have overridden the `@vercel/og` package with `workers-og`, you can install the dependencies.

:::code-group

```bash [npm]
npm install frames.js react
```

```bash [yarn]
yarn add frames.js react
```

```bash [pnpm]
pnpm add frames.js react
```

:::
::::

## Write your Frames handler

::::steps

### Delete generated file

Delete the `src/index.ts` file that was generated by `wrangler`.

### Create a file with your Frames app handler

Create `src/index.tsx` file and paste the following code inside.

```tsx [src/index.tsx]
import { createFrames, Button } from "frames.js/cloudflare-workers";

const frames = createFrames();

const fetch = frames(async ({ message, searchParams }) => {
  const hasClicked = !!(message && searchParams.clicked);

  return {
    image: <span>{hasClicked ? `Clicked ✅` : `Clicked ❌`}</span>,a
    buttons: !hasClicked
      ? [
          <Button action="post" target={{ query: { clicked: true } }}>
            Click Me
          </Button>,
        ]
      : [
          <Button action="post" target="/">
            Reset
          </Button>,
        ],
  };
});

export default {
  fetch,
} satisfies ExportedHandler;
```

### Configure Typescript to use React jsx runtime

Open `tsconfig.json` and change the value of `compilerOptions.tsx` to `react-jsx`.

```json [tsconfig.json]
{
  "compilerOptions": {
    "jsx": "react-jsx"
  }
}
```

### Change the entrypoint for your Frames handler

Open `wrangler.toml` and change the value of `main` to `src/index.tsx`.

```toml [wrangler.toml]
main = "src/index.tsx"
```

::::

## Develop and test locally

You can test your Cloudflare Worker locally using `wrangler dev` and our [debugger](/guides/debugger#local-debugger-cli). Follow these steps to start developing locally:

::::steps

#### Start the local server

:::code-group

```bash [npm]
npm run dev
```

```bash [yarn]
yarn dev
```

```bash [pnpm]
pnpm dev
```

:::

#### Start the debugger

After you started the local server, you can start the debugger by running the following command where you replace `<local-url>` with a URL on which local server is running (see the output of above command, e.g. `http://localhost:8787`).

:::code-group

```bash [npm]
npx @frames.js/debugger --url <local-url>
```

```bash [yarn]
# yarn v1 doesn't have an alternative to npx, so you have to install the debugger globally (or use npx)
yarn global add @frames.js/debugger && frames --url <local-url>

# yarn v2
yarn dlx @frames.js/debugger --url <local-url>
```

```bash [pnpm]
pnpm dlx @frames.js/debugger --url <local-url>
```

:::

::::

## Deploy to Cloudflare Workers

When you tested your Frames app locally and you are ready to deploy it to Cloudflare Workers, run the following command.

:::code-group

```bash [npm]
npm run deploy
```

```bash [yarn]
yarn deploy
```

```bash [pnpm]
pnpm deploy
```

:::
